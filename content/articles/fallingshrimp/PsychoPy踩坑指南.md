# PsychoPy踩坑指南

最近在研究一个**SSVEP**视觉刺激实验，使用了`psychopy`来呈现画面，这个神人库也是bug有一堆。

## 故做如下记录

### 1.事件循环机制极其垃圾

这个库的核心的事件循环线程是不会自动回收的，必须要手动`core.quit()`才能回收。如果你在所有窗口都关闭之前就退出事件循环，那窗口会直接卡死再也无法响应，必须得taskkill，即使是用Ctrl+C强制结束进程后这个未响应窗口仍会一直存在着，这个快捷键仅仅只是释放了终端光标而已。

另外，如果有什么耗时操作占着主线程，窗口也会未响应。当然我指的**不是**同步阻塞，而是基于`asyncio`的异步任务，总之只要任何一个耗时任务在运行，就会卡他的事件循环，不知道是特意设计还是啥问题。

### 2.模块组织得极其混乱

不管用哪个打包器（我试过`pyinstaller`、`nuitka`、`cx_Freeze`）都无法直接正确分析出来psychopy的依赖树，手动添加了很多根本没用到的隐藏依赖。

其次，导入耗时非常长，很多并不是核心功能的模块被隐式加载了实际上没用到。

### 3.类型定义缺失 不注重类型安全

`visual.Window`这个类是有一个构造参数叫**winType**的（使用的渲染后端类型，可以用**pyglet**/**GLFW**/**pygame**），但是根本没有写泛型来声明窗口句柄的具体类型，这是一个例子，这个库几乎**所有字段**的类型都是**Any | Unknown | None**，根本过不了静态类型检查。
